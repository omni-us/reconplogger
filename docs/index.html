

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>plogger - omni:us python logger &mdash; plogger 2.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> plogger
          

          
          </a>

          
            
            
              <div class="version">
                2.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">plogger</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>plogger - omni:us python logger</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="plogger-omni-us-python-logger">
<h1>plogger - omni:us python logger<a class="headerlink" href="#plogger-omni-us-python-logger" title="Permalink to this headline">¶</a></h1>
<p>This repository contains the code of plogger, a python package to ease the
standardization of logging within omni:us. The main design decision of plogger
is to allow total freedom to reconfigure loggers without hard coding anything.</p>
<p>The package contains essentially three things:</p>
<ul class="simple">
<li><p>A default logging configuration.</p></li>
<li><p>A function to load logging configuration from any of: config file, environment variable, or default.</p></li>
<li><p>A function to replace the handlers of an existing Logger object.</p></li>
</ul>
</div>
<div class="section" id="how-to-use">
<h1>How to use<a class="headerlink" href="#how-to-use" title="Permalink to this headline">¶</a></h1>
<div class="section" id="add-as-requirement">
<h2>Add as requirement<a class="headerlink" href="#add-as-requirement" title="Permalink to this headline">¶</a></h2>
<p>The first step to use plogger is adding it as a requirement in the respective
package where it will be used. This means adding it in the file <cite>setup.cfg</cite> as
an item in <cite>install_requires</cite> or in an <cite>extras_require</cite> depending on whether
plogger is intended to be a core or an optional requirement.</p>
<p>Note: It is highly discouraged develop packages in which requirements are added
directly to <cite>setup.py</cite> or to have an ambiguous <cite>requirements.txt</cite> file.</p>
</div>
<div class="section" id="loading-configuration">
<h2>Loading configuration<a class="headerlink" href="#loading-configuration" title="Permalink to this headline">¶</a></h2>
<p>The most important functionality that plogger provides is the func:<cite>load_config</cite>
function, whose purpose is just to ease loading of a python logging
configuration. The loading of configuration can be from a file (giving its
path), from an environment variable (giving the variable name), or loading the
default configuration that comes with plogger. The loading from file and from
environment variable expects the format to be yaml or json. See below examples
of loading for each of the cases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plogger</span>

<span class="c1">## Load from config file</span>
<span class="n">plogger</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;/path/to/config.yaml&#39;</span><span class="p">)</span>

<span class="c1">## Load from environment variable</span>
<span class="n">plogger</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;PLOGGER_CFG&#39;</span><span class="p">)</span>

<span class="c1">## Load default config</span>
<span class="n">plogger</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;plogger_default&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-configured-logger">
<h2>Using a configured logger<a class="headerlink" href="#using-a-configured-logger" title="Permalink to this headline">¶</a></h2>
<p>After loading a logging configuration, using a logger is as usual with the
python logging library. Just get the respective logger and use it. The only
thing to consider is that to allow total freedom to reconfigure loggers without
hard coding anything, the name of the logger should also be a variable. So,
a logging configuration might define many handlers and loggers, whose names
are unknown to the program using plogger. So the name of the logger to use
should also be given as parameter.</p>
<p>Consider for example that you have an environment variable with the name of the
logger to use that is defined in a logging configuration defined in another
environment variable, as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PLOGGER_NAME</span><span class="o">=</span><span class="s2">&quot;example_logger&quot;</span>

<span class="nb">export</span> <span class="nv">PLOGGER_CFG</span><span class="o">=</span><span class="s2">&quot;{</span>
<span class="s2">    &#39;version&#39;: 1,</span>
<span class="s2">    &#39;formatters&#39;: {</span>
<span class="s2">        &#39;verbose&#39;: {</span>
<span class="s2">            &#39;format&#39;: &#39;%(levelname)s %(asctime)s %(module)s %(process)d %(thread)d %(message)s&#39;</span>
<span class="s2">        },</span>
<span class="s2">    },</span>
<span class="s2">    &#39;handlers&#39;: {</span>
<span class="s2">        &#39;console&#39;:{</span>
<span class="s2">            &#39;level&#39;:&#39;DEBUG&#39;,</span>
<span class="s2">            &#39;class&#39;:&#39;logging.StreamHandler&#39;,</span>
<span class="s2">            &#39;formatter&#39;: &#39;verbose&#39;</span>
<span class="s2">        },</span>
<span class="s2">    },</span>
<span class="s2">    &#39;loggers&#39;: {</span>
<span class="s2">        &#39;example_logger&#39;: {</span>
<span class="s2">            &#39;handlers&#39;: [&#39;console&#39;],</span>
<span class="s2">            &#39;level&#39;: &#39;ERROR&#39;,</span>
<span class="s2">        },</span>
<span class="s2">    }</span>
<span class="s2">}&quot;</span>
</pre></div>
</div>
<p>Then, in the python code the logger would be used as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">plogger</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span> <span class="o">=</span> <span class="n">plogger</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;PLOGGER_CFG&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PLOGGER_NAME&#39;</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;My error message&#39;</span><span class="p">)</span>
<span class="go">ERROR 2019-10-18 14:45:22,629 &lt;stdin&gt; 16876 139918773925696 My error message</span>
</pre></div>
</div>
</div>
<div class="section" id="replacing-logger-handlers">
<h2>Replacing logger handlers<a class="headerlink" href="#replacing-logger-handlers" title="Permalink to this headline">¶</a></h2>
<p>In some cases it might be needed to replace the handlers of some already
existing logger. For this plogger provides the <code class="xref py py-func docutils literal notranslate"><span class="pre">replace_logger_handlers()</span></code>
function. To use it, simply provide the logger in which to replace the handlers
and the logger from where to get the handlers. Using the same environment
variables as above, the procedure would be as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plogger</span>

<span class="n">plogger</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;PLOGGER_CFG&#39;</span><span class="p">)</span>
<span class="n">plogger</span><span class="o">.</span><span class="n">replace_logger_handlers</span><span class="p">(</span><span class="s1">&#39;some_logger_name&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PLOGGER_NAME&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="standardizing-logging-in-flask-based-microservices">
<h1>Standardizing logging in flask-based microservices<a class="headerlink" href="#standardizing-logging-in-flask-based-microservices" title="Permalink to this headline">¶</a></h1>
<p>The most important objective of plogger is to allow standardization logging from
all microservices developed. Thus, the logging from all microservices should be
configured like explained here. All important sources of logs should be
reconfigured, so that all logs have a common format and can be properly indexed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plogger</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="o">...</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="o">...</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">plogger</span><span class="o">.</span><span class="n">flask_app_logger_setup</span><span class="p">(</span><span class="s1">&#39;PLOGGER_CFG&#39;</span><span class="p">,</span> <span class="s1">&#39;PLOGGER_NAME&#39;</span><span class="p">,</span> <span class="n">app</span><span class="p">)</span>

<span class="c1">## NOTE: do not change logger beyond this point!</span>

<span class="o">...</span>

<span class="c1">## Use</span>
<span class="n">myclass</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
<p>An important note is that after configuring the logger, the code should not
modify the logger configuration. For example, do not set the logging level.</p>
<p>In the helm <cite>values.yaml</cite> of the microservice, the default values for the
envirnoment variables should be set as:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">PLOGGER_CFG</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">plogger_default</span>
<span class="nt">PLOGGER_NAME</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">plogger</span>
</pre></div>
</div>
</div>
<div class="section" id="contributing">
<h1>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h1>
<p>Contributions to this package are very welcome. When you intend to work with the
source code, note that this project does not include a <code class="code docutils literal notranslate"><span class="pre">requirements.txt</span></code>
file. This is by intention. To make it very clear what are the requirements for
different use cases, all the requirements of the project are stored in the file
<code class="code docutils literal notranslate"><span class="pre">setup.cfg</span></code>. The basic runtime requirements are defined in section
<code class="code docutils literal notranslate"><span class="pre">[options]</span></code> in the <code class="code docutils literal notranslate"><span class="pre">install_requires</span></code> entry. All optional
requirements are stored in section <code class="code docutils literal notranslate"><span class="pre">[options.extras_require]</span></code>. There is a
<code class="code docutils literal notranslate"><span class="pre">dev</span></code> extras require to be used by developers (e.g. requirements to run
the unit tests) and a <code class="code docutils literal notranslate"><span class="pre">bump</span></code> extras require for the maintainer of the
package.</p>
<p>The recommended way to work with the source code is the following. First clone
the repository, then create a virtual environment, activate it and finally
install the development requirements. More precisely the steps would be:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone ssh://git@code.omnius.corp:7999/bkd/plogger.git
<span class="nb">cd</span> plogger
virtualenv -p python3 venv
. venv/bin/activate
</pre></div>
</div>
<p>The crucial step is installing the requirements which would be done by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install --editable .<span class="o">[</span>dev<span class="o">]</span>
</pre></div>
</div>
<p>After changing the code, always run unit tests as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./setup.py <span class="nb">test</span>
</pre></div>
</div>
<p>#### Using bump version</p>
<p>As part of contribution please use bumpversion to bump up the version on master.</p>
<p><code class="docutils literal notranslate"><span class="pre">`bumpversion</span> <span class="pre">major/minor/path</span> <span class="pre">plogger/__version__.py`</span></code></p>
<p>Push the tags to the repository as well</p>
<p><code class="docutils literal notranslate"><span class="pre">`git</span> <span class="pre">push;</span> <span class="pre">git</span> <span class="pre">push</span> <span class="pre">--tags`</span></code></p>
<p>Create the bdist_whl and push to pypi repository using twine</p>
<p><code class="docutils literal notranslate"><span class="pre">`twine</span> <span class="pre">upload</span> <span class="pre">--repository-url</span> <span class="pre">https://pypi.omnius.com</span> <span class="pre">--username</span> <span class="pre">jenkins</span> <span class="pre">--password</span> <span class="pre">&quot;&quot;</span> <span class="pre">dist/plogger-&lt;version&gt;-py3-none-any.whl</span> <span class="pre">`</span></code></p>
</div>
<div class="section" id="documentation-contents">
<h1>Documentation Contents<a class="headerlink" href="#documentation-contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#module-plogger.plogger">plogger module</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-present, omni:us

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>